---
import { GitFork, Star } from "lucide-react";

const { name, repository } = Astro.props;

const GITHUB_TOKEN = import.meta.env.GITHUB_TOKEN;

const fetchRepo = async (name: string, repository: string) => {
  const response = await fetch(
    `https://api.github.com/repos/${name}/${repository}`,
    {
      headers: {
        Authorization: `token ${GITHUB_TOKEN}`,
        Accept: "application/vnd.github.v3+json",
      },
    }
  );

  if (!response.ok)
    throw new Error(
      `[${response.status} ${response.statusText}] Failed to fetch ${repository}`
    );
  return await response.json();
};

const repo = await fetchRepo(name, repository);

function getColorForLanguage(language: string) {
  const languageColors: Record<string, string> = {
    TypeScript: "#3178c6",
    JavaScript: "#f7dc6f",
    Python: "#3572A5",
    Java: "#b07219",
    Dart: "#00B4AB",
    Shell: "#89e051",
    Go: "#00ADD8",
    Ruby: "#701516",
    PHP: "#4F5D95",
    C: "#555555",
    Cpp: "#f34b7d",
    CSharp: "#178600",
    Rust: "#dea584",
    Swift: "#ffac45",
    Kotlin: "#F18E33",
    HTML: "#e34c26",
    CSS: "#563d7c",
    Vue: "#41b883",
    React: "#61dafb",
    Angular: "#dd0031",
    Svelte: "#ff3e00",
    Elixir: "#6e4a7e",
    Scala: "#c22d40",
    Haskell: "#5e5086",
    Lua: "#000080",
    Perl: "#0298c3",
    R: "#276DC3",
    ObjectiveC: "#438eff",
    Groovy: "#4298B8",
    Crystal: "#776791",
    Erlang: "#B83998",
    FSharp: "#b845fc",
    Assembly: "#6E4C13",
    MATLAB: "#e16737",
    Julia: "#a270ba",
    Clojure: "#db5855",
    CoffeeScript: "#244776",
    Solidity: "#AA6746",
    GraphQL: "#e10098",
    VisualBasic: "#945db7",
    Ada: "#02f88c",
    Fortran: "#4d41b1",
    Pascal: "#b0ce4e",
    Tcl: "#e4cc98",
    AssemblyScript: "#6c4f3d",
    Nim: "#ffc200",
    Prolog: "#74283c",
    OCaml: "#3be133",
    Scheme: "#1e4aec",
    Lisp: "#3fb68b",
    Apex: "#1797c0",
    PowerShell: "#012456",

    // Add more languages as needed
  };
  return languageColors[language] || "#ccc"; // Default color if language not found
}
---

<article class="card">
  <div>
    <!-- <p class="name sl-flex">
      {name}
    </p> -->
    <p class="repository">
      <a href={repo.html_url} target="_blank">{repository}</a>
    </p>
    <p class="description sl-flex">
      {repo.description}
    </p>
  </div>

  <div class="stats">
    <span>
      <span
        class="language-circle"
        style={`background-color: ${getColorForLanguage(repo.language)}`}
      ></span>
      {repo.language}
    </span>
    <span>
      <Star className="lucide-icon" />
      {repo.stargazers_count}
    </span>
    <span>
      <GitFork className="lucide-icon" />
      {repo.forks_count}
    </span>
  </div>
</article>

<style>
  @layer starlight.components {
    .card {
      background-color: var(--sl-color-surface);
      border: 1px solid var(--sl-color-gray-6);
      border-radius: 12px;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      transition: transform 0.2s ease-in-out;
      justify-content: space-between;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .card .body {
      margin: 0;
      font-size: clamp(
        var(--sl-text-sm),
        calc(0.5rem + 1vw),
        var(--sl-text-body)
      );
    }

    .name {
      font-weight: 300;
      font-size: 16px;
      color: var(--sl-color-gray-4);
      line-height: normal;
      gap: 1rem;
      align-items: center;
    }
    .repository {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--sl-color-white);
      margin: 0;
    }
    .repository a {
      color: var(--sl-color-white);
      text-decoration: none;
    }
    .description {
      font-weight: 400;
      font-size: 14px;
      color: var(--sl-color-gray-3);
      line-height: 1.5;
      gap: 1rem;
      align-items: center;
    }

    .stats {
      display: flex;
      gap: 1.5rem;
      font-size: 14px;
      color: var(--sl-color-gray-3);
    }

    .stats span {
      display: flex;
      align-items: center;
      font-weight: 400;
    }

    .stats .lucide-icon {
      width: 1.3em;
      height: 1.3em;
      margin-right: 0.4em;
      color: var(--sl-color-gray-3);
    }

    .language-circle {
      width: 0.8em;
      height: 0.8em;
      border-radius: 50%;
      margin-right: 0.4em;
    }
  }
</style>
